"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _http = require("http");

var _lodash = require("lodash");

var _default = ({
  log,
  extraFields
} = {}) => (err, req, res, _) => {
  var _ref, _err$status;

  let status = (_ref = (_err$status = err.status) !== null && _err$status !== void 0 ? _err$status : err.statusCode) !== null && _ref !== void 0 ? _ref : 500;

  if (status < 400) {
    status = 500;
  }

  res.status(status);
  const body = {
    status
  };

  if (process.env.NODE_ENV !== 'production') {
    body.stack = err.stack;
  }

  if (status >= 500) {
    body.message = _http.STATUS_CODES[status];

    if (log) {
      log({
        err,
        req,
        res
      });
    }

    res.json(body);
    return;
  }

  (0, _lodash.assign)(body, (0, _lodash.pick)(err, [...(extraFields !== null && extraFields !== void 0 ? extraFields : []), 'message', 'code', 'name', 'type']));
  res.json(body);
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJsb2ciLCJleHRyYUZpZWxkcyIsImVyciIsInJlcSIsInJlcyIsIl8iLCJzdGF0dXMiLCJzdGF0dXNDb2RlIiwiYm9keSIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsInN0YWNrIiwibWVzc2FnZSIsIlNUQVRVU19DT0RFUyIsImpzb24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7ZUFtQmUsQ0FBQztBQUFDQSxFQUFBQSxHQUFEO0FBQU1DLEVBQUFBO0FBQU4sSUFBcUQsRUFBdEQsS0FBNkQsQ0FBQ0MsR0FBRCxFQUF1QkMsR0FBdkIsRUFBcUNDLEdBQXJDLEVBQW9EQyxDQUFwRCxLQUF3RTtBQUFBOztBQUNsSixNQUFJQyxNQUFjLDBCQUFHSixHQUFHLENBQUNJLE1BQVAscURBQWlCSixHQUFHLENBQUNLLFVBQXJCLHVDQUFtQyxHQUFyRDs7QUFFQSxNQUFJRCxNQUFNLEdBQUcsR0FBYixFQUFrQjtBQUNoQkEsSUFBQUEsTUFBTSxHQUFHLEdBQVQ7QUFDRDs7QUFFREYsRUFBQUEsR0FBRyxDQUFDRSxNQUFKLENBQVdBLE1BQVg7QUFFQSxRQUFNRSxJQUFrQixHQUFHO0FBQ3pCRixJQUFBQTtBQUR5QixHQUEzQjs7QUFJQSxNQUFJRyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsUUFBWixLQUF5QixZQUE3QixFQUEyQztBQUN6Q0gsSUFBQUEsSUFBSSxDQUFDSSxLQUFMLEdBQWFWLEdBQUcsQ0FBQ1UsS0FBakI7QUFDRDs7QUFFRCxNQUFJTixNQUFNLElBQUksR0FBZCxFQUFtQjtBQUNqQkUsSUFBQUEsSUFBSSxDQUFDSyxPQUFMLEdBQWVDLG1CQUFhUixNQUFiLENBQWY7O0FBRUEsUUFBSU4sR0FBSixFQUFTO0FBQ1BBLE1BQUFBLEdBQUcsQ0FBQztBQUFDRSxRQUFBQSxHQUFEO0FBQU1DLFFBQUFBLEdBQU47QUFBV0MsUUFBQUE7QUFBWCxPQUFELENBQUg7QUFDRDs7QUFFREEsSUFBQUEsR0FBRyxDQUFDVyxJQUFKLENBQVNQLElBQVQ7QUFFQTtBQUNEOztBQUVELHNCQUFPQSxJQUFQLEVBQWEsa0JBQUtOLEdBQUwsRUFBVyxDQUFDLElBQUlELFdBQUosYUFBSUEsV0FBSixjQUFJQSxXQUFKLEdBQW1CLEVBQW5CLENBQUQsRUFBeUIsU0FBekIsRUFBb0MsTUFBcEMsRUFBNEMsTUFBNUMsRUFBb0QsTUFBcEQsQ0FBWCxDQUFiO0FBRUFHLEVBQUFBLEdBQUcsQ0FBQ1csSUFBSixDQUFTUCxJQUFUO0FBQ0QsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7U1RBVFVTX0NPREVTfSBmcm9tICdodHRwJztcbmltcG9ydCB7YXNzaWduLCBwaWNrfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHR5cGUge1Jlc3BvbnNlLCBSZXF1ZXN0LCBOZXh0RnVuY3Rpb259IGZyb20gJ2V4cHJlc3MnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEV4cHJlc3NKc29uRXJyb3JIYW5kbGVyT3B0aW9ucyB7XG4gIGxvZz86ICh7ZXJyLCByZXEsIHJlc306IHsgZXJyOiBFcnJvcjsgcmVxOiBSZXF1ZXN0OyByZXM6IFJlc3BvbnNlIH0pID0+IHZvaWQ7XG4gIGV4dHJhRmllbGRzPzogc3RyaW5nW107XG59XG5cbmV4cG9ydCB0eXBlIEVycm9yV2l0aFN0YXR1cyA9IEVycm9yICYgeyBzdGF0dXM/OiBudW1iZXI7IHN0YXR1c0NvZGU/OiBudW1iZXIgfTtcblxuZXhwb3J0IGludGVyZmFjZSBSZXNwb25zZUJvZHkge1xuICBzdGF0dXM6IG51bWJlcjtcbiAgc3RhY2s/OiBhbnk7XG4gIG1lc3NhZ2U/OiBzdHJpbmc7XG4gIGNvZGU/OiBhbnk7XG4gIG5hbWU/OiBhbnk7XG4gIHR5cGU/OiBhbnk7XG59XG5cbmV4cG9ydCBkZWZhdWx0ICh7bG9nLCBleHRyYUZpZWxkc306IEV4cHJlc3NKc29uRXJyb3JIYW5kbGVyT3B0aW9ucyA9IHt9KSA9PiAoZXJyOiBFcnJvcldpdGhTdGF0dXMsIHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSwgXzogTmV4dEZ1bmN0aW9uKSA9PiB7XG4gIGxldCBzdGF0dXM6IG51bWJlciA9IGVyci5zdGF0dXMgPz8gZXJyLnN0YXR1c0NvZGUgPz8gNTAwO1xuXG4gIGlmIChzdGF0dXMgPCA0MDApIHtcbiAgICBzdGF0dXMgPSA1MDA7XG4gIH1cblxuICByZXMuc3RhdHVzKHN0YXR1cyk7XG5cbiAgY29uc3QgYm9keTogUmVzcG9uc2VCb2R5ID0ge1xuICAgIHN0YXR1c1xuICB9O1xuXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgYm9keS5zdGFjayA9IGVyci5zdGFjaztcbiAgfVxuXG4gIGlmIChzdGF0dXMgPj0gNTAwKSB7XG4gICAgYm9keS5tZXNzYWdlID0gU1RBVFVTX0NPREVTW3N0YXR1c107XG5cbiAgICBpZiAobG9nKSB7XG4gICAgICBsb2coe2VyciwgcmVxLCByZXN9KTtcbiAgICB9XG5cbiAgICByZXMuanNvbihib2R5KTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGFzc2lnbihib2R5LCBwaWNrKGVyciwgIFsuLi4oZXh0cmFGaWVsZHMgPz8gW10pLCAnbWVzc2FnZScsICdjb2RlJywgJ25hbWUnLCAndHlwZSddKSk7XG5cbiAgcmVzLmpzb24oYm9keSk7XG59O1xuIl19